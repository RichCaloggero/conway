<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

<title>panner test</title>

</head>
<body>
<h1>Test</h1>
<div role="status" id="status">
</div>

<script>
let testData1 = [[0,0], [5,5], [10,10], [15,15], [20,20], [25,25], [29,29]];
let testData2 = [[0,0], [1,1], [2,2], [3,3], [4,4], [5,5], [6,6], [7,7], [8,8], [9,9], [10,10], [11,11], [12,12], [13,13], [14,14], [15,15], [16,16], [17,17], [18,18], [19,19], [20,20], [21,21], [22,22], [23,23], [24,24], [25,25], [26,26], [27,27], [28,28], [29,29]];

let testData = testData2;
let dt = 100;
let audio = new AudioContext();
let p = createPanners (audio, 30);
let o = createOscillator (audio, 600);
let output = audio.createGain();
output.gain.value = .1;
output.connect (audio.destination);
let panner = createPanner (audio, 0,0, 30);
panner.connect (output);

audio.listener.setPosition (15, -1, 15);
audio.listener.setOrientation (0,0,-1, 0,1,0);
panner.setOrientation (0,0,0);

runTest (testData);

function runTest (data) {
if (!data || data.length <= 0) return;
let [x,y] = data.shift();
panner.positionX.value = x;
panner.positionZ.value = y;
o.connect (panner);
message (`${x},${y} => ${panner.positionX.value},${panner.positionZ.value}, ${panner.orientationX.value}, ${panner.orientationZ.value}`);

setTimeout (() => {
o.disconnect (panner);
setTimeout (() => runTest (data), dt);
}, dt);
} // runTest


function createOscillator (audio, frequency) {
let osc = audio.createOscillator ();
osc.frequency.value = frequency;
osc.start ();
return osc;
} // createOscillator

function createPanners (audio, gridSize) {
let output = audio.createGain ();
output.gain.value = 0.05;
output.connect (audio.destination);

let result = [];
for (let r =0; r < gridSize; r++) {
let row = [];

for (let c =0; c < gridSize; c++) {
let panner = createPanner (audio, r,c, gridSize);
panner.connect (output);
row.push (panner);
} // for col

result.push (row);
} // for row

return result;
} // createPanners

function createPanner (audio, row, col, gridSize) {
let panner = audio.createPanner ();
panner.setOrientation (0,0,0);
panner.panningModel = "HRTF";
panner.distanceModel = "linear";
//panner.distanceModel = 'inverse';
panner.refDistance = 1;
panner.maxDistance = 0;
panner.rolloffFactor = 1;
panner.coneInnerAngle = 360;
panner.coneOuterAngle = 0;
panner.coneOuterGain = 0;

return panner;
} // createPanner

function message (text) {
document.querySelector ("#status").innerHTML = text;
} // message

</script>

</body>
</html>
